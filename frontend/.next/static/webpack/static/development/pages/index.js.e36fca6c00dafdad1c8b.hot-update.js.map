{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.e36fca6c00dafdad1c8b.hot-update.js","sources":["webpack:///./components/PostCard.js","webpack:///./components/PostCardContent.js"],"sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\r\nimport { Button, Card, Avatar, Icon, Form, Input, Comment, List } from \"antd\";\r\nimport PropTypes from \"prop-types\";\r\nimport Link from \"next/link\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport {\r\n  ADD_COMMENT_REQUEST,\r\n  LOAD_COMMENTS_REQUEST,\r\n  UNLIKE_POST_REQUEST,\r\n  LIKE_POST_REQUEST,\r\n  RETWEET_REQUEST\r\n} from \"../reducers/post\";\r\nimport PostImages from \"./PostImages\";\r\nimport PostCardContent from \"./PostCardContent\";\r\n\r\nconst PostCard = ({ post }) => {\r\n  const [commentFormOpened, setCommentFormOpened] = useState(false);\r\n  const [commentText, setCommentText] = useState(\"\");\r\n  const { me } = useSelector(state => state.user);\r\n  const { commentAdded, isAddingComment } = useSelector(state => state.post);\r\n  const dispatch = useDispatch();\r\n\r\n  const liked = me && post.Likers && post.Likers.find(v => v.id === me.id);\r\n\r\n  const onToggleComment = useCallback(() => {\r\n    setCommentFormOpened(prev => !prev); //열렸으면 닫고, 닫혔으면 열고..\r\n    if (!commentFormOpened) {\r\n      dispatch({\r\n        type: LOAD_COMMENTS_REQUEST,\r\n        data: post.id\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  const onSubmitComment = useCallback(\r\n    e => {\r\n      e.preventDefault();\r\n      if (!me) {\r\n        return alert(\"로그인이 필요합니다.\");\r\n      }\r\n      return dispatch({\r\n        type: ADD_COMMENT_REQUEST,\r\n        data: {\r\n          postId: post.id,\r\n          content: commentText\r\n        }\r\n      });\r\n    },\r\n    [me && me.id, commentText]\r\n  );\r\n\r\n  useEffect(() => {\r\n    setCommentText(\"\");\r\n  }, [commentAdded === true]);\r\n\r\n  const onChangeCommentText = useCallback(e => {\r\n    setCommentText(e.target.value);\r\n  }, []);\r\n\r\n  const onToggleLike = useCallback(() => {\r\n    if (!me) {\r\n      return alert(\"로그인이 필요합니다\");\r\n    }\r\n    if (liked) {\r\n      // 좋아요를 누른 상태\r\n      dispatch({\r\n        type: UNLIKE_POST_REQUEST,\r\n        data: post.id\r\n      });\r\n    } else {\r\n      // 좋아요를 안 누른 상태\r\n      dispatch({\r\n        type: LIKE_POST_REQUEST,\r\n        data: post.id\r\n      });\r\n    }\r\n  }, [me && me.id, post && post.id, liked]);\r\n\r\n  const onRetweet = useCallback(() => {\r\n    if (!me) {\r\n      return alert(\"로그인이 필요합니다\");\r\n    }\r\n    return dispatch({\r\n      type: RETWEET_REQUEST,\r\n      data: post.id\r\n    });\r\n  }, [me && me.id, post && post.id]);\r\n\r\n  return (\r\n    <div>\r\n      <Card\r\n        style={{ marginTop: \"10px\" }}\r\n        key={+post.createdAt}\r\n        cover={post.Images[0] && <PostImages images={post.Images} />}\r\n        actions={[\r\n          <Icon type=\"retweet\" key=\"retweet\" onClick={onRetweet} />,\r\n          <Icon\r\n            type=\"heart\"\r\n            key=\"heart\"\r\n            theme={liked ? \"twoTone\" : \"outlined\"}\r\n            twoToneColor=\"#eb2f96\"\r\n            onClick={onToggleLike}\r\n          />,\r\n          <Icon type=\"message\" key=\"message\" onClick={onToggleComment} />,\r\n          <Icon type=\"ellipsis\" key=\"ellipsis\" />\r\n        ]}\r\n        title={post.RetweetId ? `${post.User.nickname}님이 리트윗하셨습니다.` : null}\r\n        extra={<Button>팔로우</Button>}\r\n      >\r\n        {post.RetweetId && post.Retweet ? (\r\n          <Card cover={post.Retweet.Images[0] && <PostImages images={post.Retweet.Images} />} >\r\n            <Card.Meta\r\n              avatar={\r\n                <Link\r\n                  href={{ pathname: \"/user\", query: { id: post.Retweet.User.id } }}\r\n                  as={`/user/${post.Retweet.User.id}`}\r\n                >\r\n                  <a>\r\n                    <Avatar>{post.Retweet.User.nickname[0]}</Avatar>\r\n                  </a>\r\n                </Link>\r\n              }\r\n              title={post.Retweet.User.nickname}\r\n              description={<PostCardContent postData={post.Retweet.content} />}\r\n            />\r\n          </Card>\r\n        ) : (\r\n          <Card.Meta\r\n            avatar={\r\n              <Link\r\n                href={{ pathname: \"/user\", query: { id: post.User.id } }}\r\n                as={`/user/${post.User.id}`}\r\n              >\r\n                <a>\r\n                  <Avatar>{post.User.nickname[0]}</Avatar>\r\n                </a>\r\n              </Link>\r\n            }\r\n            title={post.User.nickname}\r\n            description={<PostCardContent postData={post.content} />}\r\n          />\r\n        )}\r\n      </Card>\r\n      {commentFormOpened && (\r\n        <>\r\n          <Form onSubmit={onSubmitComment}>\r\n            <Form.Item>\r\n              <Input.TextArea\r\n                rows={4}\r\n                value={commentText}\r\n                onChange={onChangeCommentText}\r\n              />\r\n            </Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\" loading={isAddingComment}>\r\n              삐약\r\n            </Button>\r\n          </Form>\r\n          <List\r\n            header={`${post.Comments ? post.Comments.length : 0} 댓글`}\r\n            itemLayout=\"horizontal\"\r\n            dataSource={post.Comments || []}\r\n            renderItem={item => (\r\n              <li>\r\n                <Comment\r\n                  author={item.User.nickname}\r\n                  avatar={\r\n                    <Link\r\n                      href={{ pathname: \"/user\", query: { id: item.User.id } }}\r\n                      as={`/user/${item.User.id}`}\r\n                    >\r\n                      <a>\r\n                        <Avatar>{item.User.nickname[0]}</Avatar>\r\n                      </a>\r\n                    </Link>\r\n                  }\r\n                  content={item.content}\r\n                />\r\n              </li>\r\n            )}\r\n          />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nPostCard.propTypes = {\r\n  post: PropTypes.shape({\r\n    User: PropTypes.object,\r\n    content: PropTypes.string,\r\n    img: PropTypes.string,\r\n    createdAt: PropTypes.object\r\n  })\r\n};\r\n\r\nexport default PostCard;\r\n","import React from 'react';\r\nimport Link from \"next/link\";\r\nimport PropTypes from 'prop-types';\r\n\r\nconst PostCardContent = ({ postData }) => {\r\n  return (\r\n    <div>\r\n      {postData.split(/(#[^\\s]+)/g).map(v => {\r\n        // 해시태그의 링크넣기 -> a tag가 아닌 next의 Link를 써야 spa 가 유지가 된다\r\n        if (v.match(/#[^\\s]+/)) {\r\n          return (\r\n            <Link\r\n              href={{\r\n                pathname: \"/hashtag\",\r\n                query: { tag: v.slice(1) }\r\n              }}\r\n              as={`/hashtag/${v.slice(1)}`}\r\n              key={v}\r\n            >\r\n              <a>{v}</a>\r\n            </Link>\r\n          );\r\n        }\r\n        return v;\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nPostCardContent.propTypes = {\r\n    postData: PropTypes.string.isRequired,\r\n}\r\n\r\nexport default PostCardContent;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAGA;AAAA;AAHA;AACA;AADA;AAIA;AAAA;AAJA;AAAA;AACA;AAIA;AAEA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAOA;AAIA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AAEA;AAGA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAOA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAjBA;AAoBA;AAAA;AAAA;AAAA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAFA;AASA;AACA;AAAA;AAAA;AAZA;AAiBA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAFA;AASA;AACA;AAAA;AAAA;AAZA;AAkBA;AAAA;AAGA;AACA;AACA;AAHA;AAMA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAFA;AASA;AAZA;AAFA;AAJA;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AADA;AASA;;;;;;;;;;;;;;;;;;;;ACnMA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAFA;AAIA;AACA;AANA;AAWA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AADA;AAIA;;;;A","sourceRoot":""}